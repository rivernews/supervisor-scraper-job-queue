(this["webpackJsonpsupervisor-scraper-job-queue"]=this["webpackJsonpsupervisor-scraper-job-queue"]||[]).push([[0],{20:function(e,t,n){e.exports={renewalForm:"renewal-job-form_renewalForm__2a6rn",field:"renewal-job-form_field__V5AVd",input:"renewal-job-form_input__37mDi",submitButton:"renewal-job-form_submitButton__3OXbv"}},39:function(e,t,n){e.exports={App:"App_App__16ZpL"}},42:function(e,t,n){e.exports=n(54)},47:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var a,r=n(0),l=n.n(r),o=n(36),s=n.n(o),u=(n(47),n(16)),c=n(12),i=n(3),m=n(23),p=n(1),d=n.n(p),b=n(5),v=n(28),f=n(17),E=n(13),y=n(14);!function(e){e.REGULAR="regular",e.RENEWAL="renewal"}(a||(a={}));var h=function(){function e(t){Object(E.a)(this,e),this.orgId=void 0,this.orgName=void 0,this.lastProgress=void 0,this.lastReviewPage=void 0,this.scrapeMode=void 0,this.orgId=t.orgId,this.orgName=t.orgName,this.lastProgress=t.lastProgress,this.lastReviewPage=t.lastReviewPage,this.scrapeMode=t.scrapeMode}return Object(y.a)(e,null,[{key:"validate",value:function(e){var t=!0,n=!1,a=void 0;try{for(var r,l=["orgId","orgName","lastReviewPage","scrapeMode"][Symbol.iterator]();!(t=(r=l.next()).done);t=!0){var o=r.value;if(!e[o])return Object(f.a)({},o,"required")}}catch(m){n=!0,a=m}finally{try{t||null==l.return||l.return()}finally{if(n)throw a}}var s=g.validate(e.lastProgress);if(s){var u=Object.keys(s),c=Object(i.a)(u,1)[0];return Object(f.a)({},"lastProgress.".concat(c),s[c])}}}]),e}(),g=function(){function e(){Object(E.a)(this,e)}return Object(y.a)(e,null,[{key:"_validate",value:function(e,t,n){if(typeof e[t]!==n)return Object(f.a)({},t,"required")}},{key:"validate",value:function(t){var n=!0,a=!1,r=void 0;try{for(var l,o=[{key:"processed",type:"number"},{key:"wentThrough",type:"number"},{key:"total",type:"number"},{key:"durationInMilli",type:"string"},{key:"page",type:"number"},{key:"processedSession",type:"number"}][Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var s=l.value,u=e._validate(t,s.key,s.type);if(u)return u}}catch(c){a=!0,r=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw r}}}}]),e}(),O=n(26),k=function(e,t){var n=t.split("."),a=Object(O.a)(n),r=a[0];return a.slice(1).reduce((function(e,t){return e?e[t]:e}),e[r])},S=n(20),j=n.n(S),_=function(){function e(){Object(E.a)(this,e),this._token=void 0,this._port=void 0,this._token=this.loadValue(e.TOKEN_CACHE_KEY),this._port=this.loadValue(e.PORT_CACHE_KEY)}return Object(y.a)(e,[{key:"loadValue",value:function(t){var n=localStorage.getItem(t);return null!==n?n:(localStorage.setItem(e.TOKEN_CACHE_KEY,""),"")}},{key:"setValue",value:function(e,t){return localStorage.setItem(t,e),e}},{key:"getValue",value:function(e,t){if(e&&""!==e)return e;var n=localStorage.getItem(t);return null!==n?n:(localStorage.setItem(t,""),"")}},{key:"token",set:function(t){this._token=this.setValue(t,e.TOKEN_CACHE_KEY)},get:function(){return this._token=this.getValue(this._token,e.TOKEN_CACHE_KEY),this._token}},{key:"port",set:function(t){this._port=this.setValue(t,e.PORT_CACHE_KEY)},get:function(){return this._port=this.getValue(this._port,e.PORT_CACHE_KEY),this._port}}],[{key:"singleton",get:function(){return e._singleton||(e._singleton=new e),e._singleton}}]),e}();_._singleton=void 0,_.TOKEN_CACHE_KEY="supervisor-scraper-job-queue:renewal-job-form:token",_.PORT_CACHE_KEY="supervisor-scraper-job-queue:renewal-job-form:port";var R=_.singleton,w=[{name:"orgInfo",type:"text"},{name:"orgId",type:"text"},{name:"orgName",type:"text"},{name:"lastProgress.processed",type:"number"},{name:"lastProgress.wentThrough",type:"number"},{name:"lastProgress.total",type:"number"},{name:"lastProgress.durationInMilli",type:"text"},{name:"lastProgress.page",type:"number"},{name:"lastProgress.processedSession",type:"number"},{name:"lastReviewPage",type:"url"},{name:"port",type:"text"},{name:"token",type:"text"}],P={orgInfo:"",orgId:"1138",orgName:"Apple",lastProgress:{processed:4413,wentThrough:4610,total:15407,durationInMilli:"5430000",page:461,processedSession:3},lastReviewPage:"https://www.glassdoor.com/Reviews/Apple-Reviews-E1138_P461.htm",scrapeMode:"renewal",port:R.port,token:R.token},C=function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a,r,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.setSubmitting,e.next=3,fetch((window.location.href.startsWith("https")?"https://slack.api.shaungc.com/queues/single-org-renewal-job?":"http://localhost:".concat(t.port,"/queues/single-org-renewal-job?"))+new URLSearchParams({token:t.token}),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:if(200!==(r=e.sent).status){e.next=14;break}return e.next=7,r.json();case 7:return l=e.sent,localStorage.setItem("supervisor-scraper-job-queue:renewal-job-form:token",t.token),alert("Submit success! Job number "+l.id),a(!1),e.abrupt("return",l);case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),N=function(e){return l.a.createElement("div",{className:j.a.renewalForm},l.a.createElement(v.a,{initialValues:Object(m.a)({},P,{token:R.token,port:R.port}),validate:function(e){return h.validate(e)},onSubmit:function(){var t=Object(b.a)(d.a.mark((function t(n,a){var r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C(n,a);case 2:r=t.sent,e.onReceiveResponse&&e.onReceiveResponse(r);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},(function(e){var t=e.values,n=e.errors,a=e.touched,r=e.handleChange,o=e.handleBlur,s=e.handleSubmit,u=e.isSubmitting;return l.a.createElement("form",{onSubmit:s},w.map((function(e,s){return l.a.createElement("div",{key:s,className:j.a.field},l.a.createElement("label",null,e.name,": "),l.a.createElement("input",{className:j.a.input,type:e.type,name:e.name,onChange:r,onBlur:o,value:k(t,e.name)}),k(n,e.name)&&k(a,e.name)&&k(n,e.name))})),l.a.createElement("button",{className:j.a.submitButton,type:"submit",disabled:u},"Submit"))})))};function A(){var e=Object(r.useState)({}),t=Object(i.a)(e,2),n=t[0],a=t[1];return l.a.createElement("div",null,0!==Object.keys(n).length&&l.a.createElement("div",null,JSON.stringify(n,null,4)),l.a.createElement("h1",null,"Create a New or Renewal Job"),l.a.createElement(N,{onReceiveResponse:function(e){a(e)}}))}var x=n(39),T=n.n(x);function I(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,"Home"),l.a.createElement("p",null,"This is the supervisor scraper frontend"))}var J=[{name:"token",type:"text"},{name:"port",type:"text"}],M=function(){var e=Object(b.a)(d.a.mark((function e(t,n){var a,r,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.setSubmitting,r=t.token.trim(),l=t.port.trim(),""!==r&&(R.token=r),""!==l&&(R.port=l),alert("Credentials stored"),a(!1);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),q=function(){var e={token:R.token,port:R.port};return l.a.createElement("div",null,l.a.createElement(v.a,{initialValues:e,validate:function(){},onSubmit:M},(function(e){var t=e.values,n=e.errors,a=e.touched,r=e.handleChange,o=e.handleBlur,s=e.handleSubmit,u=e.isSubmitting;return l.a.createElement("form",{onSubmit:s},J.map((function(e,s){return l.a.createElement("div",{key:s},l.a.createElement("label",null,e.name,": "),l.a.createElement("input",{type:e.type,name:e.name,onChange:r,onBlur:o,value:k(t,e.name)}),k(n,e.name)&&k(a,e.name)&&k(n,e.name))})),l.a.createElement("button",{type:"submit",disabled:u},"Store"))})))};function U(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,"Login"),l.a.createElement(q,null))}var L=function(){function e(){var t=this;Object(E.a)(this,e),this.PRODUCTION_API_SERVER_BASE_URL="//slack.api.shaungc.com",this.asyncRequest=function(){var e=Object(b.a)(d.a.mark((function e(n,a){var r,l,o,s,u=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:"POST",l=u.length>3?u[3]:void 0,o="".concat(t.baseUrl).concat(n,"?")+new URLSearchParams({token:R.token}),e.prev=3,e.next=6,fetch(o,Object(m.a)({method:r},"POST"===r&&l?{body:JSON.stringify(l)}:{},{headers:{"Content-Type":"application/json"}}));case 6:if(200===(s=e.sent).status){e.next=11;break}throw new Error("".concat(a," request failed: ").concat(s.status,", ").concat(s.statusText));case 11:return e.next=13,s.json();case 13:return e.abrupt("return",e.sent);case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(3),e.t0;case 19:case"end":return e.stop()}}),e,null,[[3,16]])})));return function(t,n){return e.apply(this,arguments)}}(),this.asyncTerminateAllJobs=function(){return t.asyncRequest("/queues/terminate-all-jobs","Terminate all job")},this.asyncResumeAllQueues=function(){return t.asyncRequest("/queues/resume-all-queues","Resume all queues")},this.asyncPauseAllQueues=function(){return t.asyncRequest("/queues/pause-all-queues","Pause all queues")},this.asyncStartS3Job=function(){return t.asyncRequest("/queues/s3-orgs-job","Start S3 Job")},this.asyncCreateNode=function(e){return t.asyncRequest("/k8s/create-node","Create node","POST",{size:e})},this.asyncListNodes=Object(b.a)(d.a.mark((function e(){var n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.asyncRequest("/k8s/list-node","List nodes");case 2:if(!(n=e.sent).scraperWorkerNodePools){e.next=6;break}return a=n.scraperWorkerNodePools,e.abrupt("return",a.flatMap((function(e){return e.nodes})));case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)}))),this.asyncCleanNodes=function(){return t.asyncRequest("/k8s/clean-node","Clear all nodes")},this.asyncGetSeleniumMicroservice=function(){return t.asyncRequest("/k8s/selenium","Get selenium","GET")},this.asyncProvisionSeleniumMicroservice=function(){return t.asyncRequest("/k8s/selenium","Provision selenium","POST")},this.asyncDestroySeleniumMicroservice=function(){return t.asyncRequest("/k8s/selenium","Destroy selenium","DELETE")}}return Object(y.a)(e,[{key:"developmentApiServerBaseUrl",get:function(){return"".concat(e.DEVELOPMENT_API_SERVER_BASE_URL,":").concat(R.port)}},{key:"baseUrl",get:function(){return this.PRODUCTION_API_SERVER_BASE_URL}}],[{key:"singleton",get:function(){return e._singleton||(e._singleton=new e),e._singleton}}]),e}();L._singleton=void 0,L.DEVELOPMENT_API_SERVER_BASE_URL="//localhost";var V=L.singleton;function D(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],a=t[1];return l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,"Control Panel"),l.a.createElement("button",{disabled:n,type:"button",onClick:Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),e.prev=1,e.next=4,V.asyncTerminateAllJobs();case 4:t=e.sent,alert(JSON.stringify(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert(JSON.stringify(e.t0));case 11:a(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))},"Terminate All Jobs"),l.a.createElement("button",{disabled:n,type:"button",onClick:Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),e.prev=1,e.next=4,V.asyncResumeAllQueues();case 4:t=e.sent,alert(JSON.stringify(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert(JSON.stringify(e.t0));case 11:a(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))},"Resume All Jobs"),l.a.createElement("button",{disabled:n,type:"button",onClick:Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),e.prev=1,e.next=4,V.asyncPauseAllQueues();case 4:t=e.sent,alert(JSON.stringify(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert(JSON.stringify(e.t0));case 11:a(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))},"Pause All Jobs"),l.a.createElement("button",{disabled:n,type:"button",onClick:Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),e.prev=1,e.next=4,V.asyncStartS3Job();case 4:t=e.sent,alert(JSON.stringify(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert("Error: "+JSON.stringify(e.t0));case 11:a(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))},"Start S3 Job"))}var G=n(41);function B(){return l.a.createElement(l.a.Fragment,null,function(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)([]),s=Object(i.a)(o,2),u=s[0],c=s[1],m=Object(r.useState)(!0),p=Object(i.a)(m,2),d=p[0],b=p[1],v=Object(r.useState)("MEDIUM"),f=Object(i.a)(v,2),E=f[0],y=f[1],h=Object(r.useState)("--"),g=Object(i.a)(h,2),O=g[0],k=g[1],S=Object(r.useState)("--"),j=Object(i.a)(S,2),_=j[0],R=j[1],w=Object(r.useState)("--"),P=Object(i.a)(w,2),C=P[0],N=P[1];Object(r.useEffect)(F(d,"ListNode",V.asyncListNodes,c,N,a),[d]);return l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,"Node Scaling"),l.a.createElement("div",null,l.a.createElement("div",null,function(e,t){return l.a.createElement("select",{onChange:function(e){t(e.target.value)},value:e},l.a.createElement("option",{value:"MEDIUM"},"Medium - 4G RAM, $20"),l.a.createElement("option",{value:"LARGE"},"Large - 8G RAM, $40"),l.a.createElement("option",{value:"LARGE_16G"},"Large - 6CPU/16G RAM, $80"),l.a.createElement("option",{value:"MEMORY_2CPU"},"Memory Optimized - 2CPU/16G RAM, $75"),l.a.createElement("option",{value:"CPU_4CPU"},"CPU Optimized - 4CPU/8G RAM, $80"),l.a.createElement("option",{value:"CPU_2CPU"},"CPU Optimized - 2CPU/4G RAM, $40"))}(E,y)),l.a.createElement("button",{disabled:n,type:"button",onClick:function(){return K("CreateNode",[V.asyncCreateNode,E],void 0,k,a)}},"Create node"),l.a.createElement("div",null,O)),l.a.createElement("div",null,l.a.createElement("button",{disabled:n,type:"button",onClick:function(){return K("DeleteNodes",V.asyncCleanNodes,void 0,R,a)}},"Delete all nodes"),l.a.createElement("div",null,_)),l.a.createElement("h2",null,"Node Status"),H(d,b),l.a.createElement("button",{disabled:n,type:"button",onClick:function(){return K("ListNode",V.asyncListNodes,c,N,a)}},"List nodes"),l.a.createElement("div",null,C),0===u.length?l.a.createElement("div",null,"No scraper worker node."):u.map((function(e,t){return e?l.a.createElement("div",{key:t},l.a.createElement("h3",null,e.name||"(No name)"),l.a.createElement("div",null,"State: ",e.status?e.status.state:JSON.stringify(e)),l.a.createElement("div",null,l.a.createElement("em",null,"Payload: ",JSON.stringify(e)))):l.a.createElement("div",{key:t},l.a.createElement("h3",null,"(Null)")," ",JSON.stringify(e))})))}(),Y())}var K=function(){var e=Object(b.a)(d.a.mark((function e(t,n,a,r,l){var o,s,u,c,i,m;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=new Date,l&&l(!0),e.prev=2,Array.isArray(n)){e.next=9;break}return e.next=6,n();case 6:s=e.sent,e.next=13;break;case 9:return u=Object(O.a)(n),c=u[0],i=u.slice(1),e.next=12,c.apply(void 0,Object(G.a)(i));case 12:s=e.sent;case 13:console.log(t,s),a&&a(s),r&&r("".concat(t," Status: OK ").concat(JSON.stringify(s)," -- ").concat(o)),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(2),r&&(m="",m=e.t0 instanceof Error?e.t0.message:JSON.stringify(e.t0),r("Error: "+m+" -- ".concat(o)));case 21:return e.prev=21,l&&l(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[2,18,21,24]])})));return function(t,n,a,r,l){return e.apply(this,arguments)}}(),F=function(e,t,n,a,r,l){return function(){if(!e){var o=setInterval((function(){return K(t,n,a,r,l)}),5e3);return function(){return clearInterval(o)}}}},H=function(e,t){return l.a.createElement("div",null,l.a.createElement("button",{onClick:function(){return t(!e)}},"Toggle polling"),l.a.createElement("span",null,"Polling is ",e?"off":"on"))};var Y=function(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(void 0),s=Object(i.a)(o,2),u=s[0],c=s[1],m=Object(r.useState)("--"),p=Object(i.a)(m,2),d=p[0],b=p[1],v=Object(r.useState)("--"),f=Object(i.a)(v,2),E=f[0],y=f[1],h=Object(r.useState)(!0),g=Object(i.a)(h,2),O=g[0],k=g[1];Object(r.useEffect)(F(O,"GetSelenium",V.asyncGetSeleniumMicroservice,c,void 0,a),[O]);return l.a.createElement(l.a.Fragment,null,l.a.createElement("h2",null,"Selenium Scaling"),l.a.createElement("button",{disabled:n,onClick:function(){return K("ProvisionSelenium",V.asyncProvisionSeleniumMicroservice,void 0,b,a)}},"Provision selenium"),l.a.createElement("div",null,d),l.a.createElement("button",{disabled:n,onClick:function(){return K("DestroySelenium",V.asyncDestroySeleniumMicroservice,void 0,y,a)}},"Destroy selenium"),l.a.createElement("div",null,E),l.a.createElement("h2",null,"Selenium Status"),H(O,k),l.a.createElement("button",{disabled:n,onClick:function(){return K("GetSelenium",V.asyncGetSeleniumMicroservice,c,void 0,a)}},"Get selenium"),u&&u.deploymentResult&&u.serviceResult?l.a.createElement("div",null,u.deploymentResult&&l.a.createElement(l.a.Fragment,null,l.a.createElement("h3",null,u.deploymentResult.body.metadata.name),u.deploymentResult.body.status.conditions.map((function(e,t){return l.a.createElement("div",{key:t},l.a.createElement("p",null,"Status: ",e.type," - ",e.message))}))),u.serviceResult&&l.a.createElement(l.a.Fragment,null,l.a.createElement("h3",null,u.serviceResult.body.metadata.name),l.a.createElement("div",null,"IP: ",u.serviceResult.body.spec.clusterIP),l.a.createElement("div",null,"Port: ",u.serviceResult.body.spec.ports.map((function(e){return e.port}))))):l.a.createElement("div",null,"--"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(l.a.createElement((function(){return l.a.createElement(u.a,null,l.a.createElement("div",{className:T.a.App},l.a.createElement("h2",null,"Navigation"),l.a.createElement("nav",null,l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement(u.b,{to:"/"},"Home")),l.a.createElement("li",null,l.a.createElement(u.b,{to:"/login"},"Login")),l.a.createElement("li",null,l.a.createElement(u.b,{to:"/k8s"},"Node scaling")),l.a.createElement("li",null,l.a.createElement(u.b,{to:"/resume-job"},"Resume Job")),l.a.createElement("li",null,l.a.createElement(u.b,{to:"/control-panel"},"Job Control Panel")),l.a.createElement("li",null,l.a.createElement("a",{href:"".concat(V.PRODUCTION_API_SERVER_BASE_URL,"/dashboard?token=").concat(R.token)},"Bull Job Queue Dashboard")))),l.a.createElement(c.c,null,l.a.createElement(c.a,{path:"/resume-job"},l.a.createElement(A,null)),l.a.createElement(c.a,{path:"/control-panel"},l.a.createElement(D,null)),l.a.createElement(c.a,{path:"/k8s"},l.a.createElement(B,null)),l.a.createElement(c.a,{path:"/login"},l.a.createElement(U,null)),l.a.createElement(c.a,{path:"/"},l.a.createElement(I,null)))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[42,1,2]]]);
//# sourceMappingURL=main.c99d16cc.chunk.js.map