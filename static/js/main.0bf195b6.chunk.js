(this["webpackJsonpsupervisor-scraper-job-queue"]=this["webpackJsonpsupervisor-scraper-job-queue"]||[]).push([[0],{20:function(e,t,n){e.exports={renewalForm:"renewal-job-form_renewalForm__2a6rn",field:"renewal-job-form_field__V5AVd",input:"renewal-job-form_input__37mDi",submitButton:"renewal-job-form_submitButton__3OXbv"}},37:function(e,t,n){e.exports={App:"App_App__16ZpL"}},40:function(e,t,n){e.exports=n(52)},45:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),s=n(33),u=n.n(s),l=(n(45),n(17)),c=n(11),i=n(15),m=n(34),p=n(1),f=n.n(p),h=n(4),b=n(25),v=n(16),d=n(12),g=n(13);!function(e){e.REGULAR="regular",e.RENEWAL="renewal"}(a||(a={}));var E=function(){function e(t){Object(d.a)(this,e),this.orgId=void 0,this.orgName=void 0,this.lastProgress=void 0,this.lastReviewPage=void 0,this.scrapeMode=void 0,this.orgId=t.orgId,this.orgName=t.orgName,this.lastProgress=t.lastProgress,this.lastReviewPage=t.lastReviewPage,this.scrapeMode=t.scrapeMode}return Object(g.a)(e,null,[{key:"validate",value:function(e){var t=!0,n=!1,a=void 0;try{for(var r,o=["orgId","orgName","lastReviewPage","scrapeMode"][Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;if(!e[s])return Object(v.a)({},s,"required")}}catch(m){n=!0,a=m}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}var u=y.validate(e.lastProgress);if(u){var l=Object.keys(u),c=Object(i.a)(l,1)[0];return Object(v.a)({},"lastProgress.".concat(c),u[c])}}}]),e}(),y=function(){function e(){Object(d.a)(this,e)}return Object(g.a)(e,null,[{key:"_validate",value:function(e,t,n){if(typeof e[t]!==n)return Object(v.a)({},t,"required")}},{key:"validate",value:function(t){var n=!0,a=!1,r=void 0;try{for(var o,s=[{key:"processed",type:"number"},{key:"wentThrough",type:"number"},{key:"total",type:"number"},{key:"durationInMilli",type:"string"},{key:"page",type:"number"},{key:"processedSession",type:"number"}][Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value,l=e._validate(t,u.key,u.type);if(l)return l}}catch(c){a=!0,r=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}}}]),e}(),k=n(39),_=function(e,t){var n=t.split("."),a=Object(k.a)(n),r=a[0];return a.slice(1).reduce((function(e,t){return e?e[t]:e}),e[r])},w=n(20),O=n.n(w),j=function(){function e(){Object(d.a)(this,e),this._token=void 0,this._port=void 0,this._token=this.loadValue(e.TOKEN_CACHE_KEY),this._port=this.loadValue(e.PORT_CACHE_KEY)}return Object(g.a)(e,[{key:"loadValue",value:function(t){var n=localStorage.getItem(t);return null!==n?n:(localStorage.setItem(e.TOKEN_CACHE_KEY,""),"")}},{key:"setValue",value:function(e,t){return localStorage.setItem(t,e),e}},{key:"getValue",value:function(e,t){if(e&&""!==e)return e;var n=localStorage.getItem(t);return null!==n?n:(localStorage.setItem(t,""),"")}},{key:"token",set:function(t){this._token=this.setValue(t,e.TOKEN_CACHE_KEY)},get:function(){return this._token=this.getValue(this._token,e.TOKEN_CACHE_KEY),this._token}},{key:"port",set:function(t){this._port=this.setValue(t,e.PORT_CACHE_KEY)},get:function(){return this._port=this.getValue(this._port,e.PORT_CACHE_KEY),this._port}}],[{key:"singleton",get:function(){return e._singleton||(e._singleton=new e),e._singleton}}]),e}();j._singleton=void 0,j.TOKEN_CACHE_KEY="supervisor-scraper-job-queue:renewal-job-form:token",j.PORT_CACHE_KEY="supervisor-scraper-job-queue:renewal-job-form:port";var S=j.singleton,P=[{name:"orgInfo",type:"text"},{name:"orgId",type:"text"},{name:"orgName",type:"text"},{name:"lastProgress.processed",type:"number"},{name:"lastProgress.wentThrough",type:"number"},{name:"lastProgress.total",type:"number"},{name:"lastProgress.durationInMilli",type:"text"},{name:"lastProgress.page",type:"number"},{name:"lastProgress.processedSession",type:"number"},{name:"lastReviewPage",type:"url"},{name:"port",type:"text"},{name:"token",type:"text"}],R={orgInfo:"",orgId:"1138",orgName:"Apple",lastProgress:{processed:4413,wentThrough:4610,total:15407,durationInMilli:"5430000",page:461,processedSession:3},lastReviewPage:"https://www.glassdoor.com/Reviews/Apple-Reviews-E1138_P461.htm",scrapeMode:"renewal",port:S.port,token:S.token},x=function(){var e=Object(h.a)(f.a.mark((function e(t,n){var a,r,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.setSubmitting,e.next=3,fetch((window.location.href.startsWith("https")?"https://slack.api.shaungc.com/queues/single-org-renewal-job?":"http://localhost:".concat(t.port,"/queues/single-org-renewal-job?"))+new URLSearchParams({token:t.token}),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:if(200!==(r=e.sent).status){e.next=14;break}return e.next=7,r.json();case 7:return o=e.sent,localStorage.setItem("supervisor-scraper-job-queue:renewal-job-form:token",t.token),alert("Submit success! Job number "+o.id),a(!1),e.abrupt("return",o);case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),A=function(e){return o.a.createElement("div",{className:O.a.renewalForm},o.a.createElement(b.a,{initialValues:Object(m.a)({},R,{token:S.token,port:S.port}),validate:function(e){return E.validate(e)},onSubmit:function(){var t=Object(h.a)(f.a.mark((function t(n,a){var r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x(n,a);case 2:r=t.sent,e.onReceiveResponse&&e.onReceiveResponse(r);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},(function(e){var t=e.values,n=e.errors,a=e.touched,r=e.handleChange,s=e.handleBlur,u=e.handleSubmit,l=e.isSubmitting;return o.a.createElement("form",{onSubmit:u},P.map((function(e,u){return o.a.createElement("div",{key:u,className:O.a.field},o.a.createElement("label",null,e.name,": "),o.a.createElement("input",{className:O.a.input,type:e.type,name:e.name,onChange:r,onBlur:s,value:_(t,e.name)}),_(n,e.name)&&_(a,e.name)&&_(n,e.name))})),o.a.createElement("button",{className:O.a.submitButton,type:"submit",disabled:l},"Submit"))})))};function C(){var e=Object(r.useState)({}),t=Object(i.a)(e,2),n=t[0],a=t[1];return o.a.createElement("div",null,0!==Object.keys(n).length&&o.a.createElement("div",null,JSON.stringify(n,null,4)),o.a.createElement("h1",null,"Create a New or Renewal Job"),o.a.createElement(A,{onReceiveResponse:function(e){a(e)}}))}var N=n(37),I=n.n(N);function T(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("h2",null,"Home"),o.a.createElement("p",null,"This is the supervisor scraper frontend"))}var V=[{name:"token",type:"text"},{name:"port",type:"text"}],J=function(){var e=Object(h.a)(f.a.mark((function e(t,n){var a,r,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.setSubmitting,r=t.token.trim(),o=t.port.trim(),""!==r&&(S.token=r),""!==o&&(S.port=o),alert("Credentials stored"),a(!1);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),q=function(){var e={token:S.token,port:S.port};return o.a.createElement("div",null,o.a.createElement(b.a,{initialValues:e,validate:function(){},onSubmit:J},(function(e){var t=e.values,n=e.errors,a=e.touched,r=e.handleChange,s=e.handleBlur,u=e.handleSubmit,l=e.isSubmitting;return o.a.createElement("form",{onSubmit:u},V.map((function(e,u){return o.a.createElement("div",{key:u},o.a.createElement("label",null,e.name,": "),o.a.createElement("input",{type:e.type,name:e.name,onChange:r,onBlur:s,value:_(t,e.name)}),_(n,e.name)&&_(a,e.name)&&_(n,e.name))})),o.a.createElement("button",{type:"submit",disabled:l},"Store"))})))};function B(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("h2",null,"Login"),o.a.createElement(q,null))}var K=function(){function e(){Object(d.a)(this,e),this.PRODUCTION_API_SERVER_BASE_URL="//slack.api.shaungc.com"}return Object(g.a)(e,[{key:"asyncPost",value:function(){var e=Object(h.a)(f.a.mark((function e(t,n){var a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(this.baseUrl).concat(t,"?")+new URLSearchParams({token:S.token}),e.prev=1,e.next=4,fetch(a,{method:"POST"});case 4:if(200===(r=e.sent).status){e.next=10;break}throw console.error(r),new Error("".concat(n," request failed: ").concat(r.status,", ").concat(r.statusText));case 10:return e.abrupt("return",r.json());case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(1),e.t0;case 16:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"asyncTerminateAllJobs",value:function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.asyncPost("/queues/terminate-all-jobs","Terminate all job");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"asyncResumeAllQueues",value:function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncPost("/queues/resume-all-queues","Resume all queues"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"asyncPauseAllQueues",value:function(){var e=Object(h.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.asyncPost("/queues/pause-all-queues","Pause all queues"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"developmentApiServerBaseUrl",get:function(){return"".concat(e.DEVELOPMENT_API_SERVER_BASE_URL,":").concat(S.port)}},{key:"baseUrl",get:function(){return this.PRODUCTION_API_SERVER_BASE_URL}}],[{key:"singleton",get:function(){return e._singleton||(e._singleton=new e),e._singleton}}]),e}();K._singleton=void 0,K.DEVELOPMENT_API_SERVER_BASE_URL="//localhost";var L=K.singleton;function U(){var e=Object(r.useState)(!1),t=Object(i.a)(e,2),n=t[0],a=t[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement("h2",null,"Control Panel"),o.a.createElement("button",{disabled:n,type:"button",onClick:Object(h.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),e.prev=1,e.next=4,L.asyncTerminateAllJobs();case 4:t=e.sent,alert(JSON.stringify(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert(JSON.stringify(e.t0));case 11:a(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))},"Terminate All Jobs"),o.a.createElement("button",{disabled:n,type:"button",onClick:Object(h.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),e.prev=1,e.next=4,L.asyncResumeAllQueues();case 4:t=e.sent,alert(JSON.stringify(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert(JSON.stringify(e.t0));case 11:a(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))},"Resume All Jobs"),o.a.createElement("button",{disabled:n,type:"button",onClick:Object(h.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),e.prev=1,e.next=4,L.asyncPauseAllQueues();case 4:t=e.sent,alert(JSON.stringify(t)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),alert(JSON.stringify(e.t0));case 11:a(!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))},"Pause All Jobs"))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(o.a.createElement((function(){return o.a.createElement(l.a,null,o.a.createElement("div",{className:I.a.App},o.a.createElement("h2",null,"Navigation"),o.a.createElement("nav",null,o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement(l.b,{to:"/"},"Home")),o.a.createElement("li",null,o.a.createElement(l.b,{to:"/login"},"Login")),o.a.createElement("li",null,o.a.createElement(l.b,{to:"/resume-job"},"Resume Job")),o.a.createElement("li",null,o.a.createElement(l.b,{to:"/control-panel"},"Control Panel")),o.a.createElement("li",null,o.a.createElement("a",{target:"_blank",href:"".concat(L.PRODUCTION_API_SERVER_BASE_URL,"/dashboard?token=").concat(S.token)},"Job Queue Dashboard")))),o.a.createElement(c.c,null,o.a.createElement(c.a,{path:"/resume-job"},o.a.createElement(C,null)),o.a.createElement(c.a,{path:"/control-panel"},o.a.createElement(U,null)),o.a.createElement(c.a,{path:"/login"},o.a.createElement(B,null)),o.a.createElement(c.a,{path:"/"},o.a.createElement(T,null)))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[40,1,2]]]);
//# sourceMappingURL=main.0bf195b6.chunk.js.map